<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqldiff PUBLIC "-//OpenMRS//DTD OpenMRS SQL Diff Config 1.0//EN" "http://resources.openmrs.org/doctype/sqldiff-1.0.dtd">

<sqldiff version="1.0">
	<help>
		USE:
			The diffs are ordered by datamodel version number.
			The script can be run in a top down fashion and is
			expected to not failor overwrite old data
		
		EXPECT:
			- "use business-database-name;" was called prior to
			   calling this script
	</help>
	
	<diff>
		<version>1.0.0</version>
		<author>Matthew Blanchette</author>
		<date>Jul 23rd 2009</date>
		<description>
			Create futureservicedelivery and log tables.
		</description>
		<sql>
			CREATE TABLE IF NOT EXISTS `motechmodule_futureservicedelivery` (
				`motechmodule_futureservicedelivery_id` int(11) NOT NULL auto_increment,
				`patient_id` int(11) NOT NULL,
				`user_id` int(11) NOT NULL,
				`delivery_datetime` datetime NOT NULL,
				`service_concept_id` int(11) NOT NULL,
				`patient_notified_date` datetime default NULL,
				`user_notified_date` datetime default NULL,
				PRIMARY KEY (`motechmodule_futureservicedelivery_id`),
				CONSTRAINT `Patient receiving future service` FOREIGN KEY (`patient_id`)
				REFERENCES `patient` (`patient_id`),
				CONSTRAINT `User delivering future service` FOREIGN KEY (`user_id`)
				REFERENCES `users` (`user_id`),
				CONSTRAINT `Concept of future service` FOREIGN KEY (`service_concept_id`)
				REFERENCES `concept` (`concept_id`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8;
			
			CREATE TABLE IF NOT EXISTS `motechmodule_log` (
				`motechmodule_log_id` int(11) NOT NULL auto_increment,
				`log_type` varchar(7) NOT NULL,
				`log_datetime` datetime NOT NULL,
				`log_message` varchar(100) NOT NULL,
				PRIMARY KEY (`motechmodule_log_id`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8;
		</sql>
	</diff>
	
</sqldiff>
